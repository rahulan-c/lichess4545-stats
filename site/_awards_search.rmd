---
title: "Season, prize and award winners"
description: |
  All winners, medallists and prize winners from past Lichess4545, LoneWolf and Lichess960 seasons.
date: 2022-04-03
site: distill::distill_website
output: distill::distill_article
---

[Return to home page](https://rahulan-c.github.io/lichess4545-stats/)

## Previous season winners

When finished, this section will show every team or player that either finished on the podium or was awarded a rating prize in past Lichess4545, LoneWolf and Lichess960 seasons.

*To be completed*

## Published award winners and honourable mentions

```{r packages_initial_opts, include = FALSE}
# Set default R chunk options for Rmd file
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Load all required packages, incl. for functions
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, knitr, rio, kableExtra, gghighlight, data.table,
               ggrepel, ggridges, reactable, htmltools, httr, jsonlite, xml2, 
               rvest, ndjson, reshape2, utf8, lubridate, tictoc, cowplot, 
               tippy)

# Define custom default reactable theme for tables
options(reactable.theme = reactableTheme(
    borderColor = "#dfe2e5",
    stripedColor = "#f6f8fa",
    highlightColor = "#f0f5f9",
    cellPadding = "8px 12px",
    searchInputStyle = list(width = "100%"),
    headerStyle = list(
      "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
      "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
      borderColor = "#555"
    ),
    style = list(fontSize = "16px")
  )
)

```


**Last refreshed on `r paste0(lubridate::day(lubridate::today()), " ", lubridate::month(lubridate::today(), label = T), " ", lubridate::year(lubridate::today()))`**


```{r, layout="l-page"}
# Crawl over the other reports and present all winners in one table

cli::cli_h2("Updating all-time awards search page...")

# Extract all links from season reports table on homepage
cli::cli_inform("Identifying published reports...")
homepage_url <- "https://rahulan-c.github.io/lichess4545-stats/season_stats.html"

season_reports <- read_html(homepage_url) %>% 
  html_nodes("table") %>% 
  html_nodes("tr") %>% 
  html_nodes("a") %>%
  html_attr("href") %>% 
  sort()

cli::cli_inform("Found {length(season_reports)} published reports")

# # Save list of season reports locally
# season_reports_tidied <- tibble::tibble(id = seq(1:length(season_reports)),
#                                   link = season_reports)
# readr::write_csv(season_reports_tidied, 
#                  file = glue::glue(here::here(), "/data/published_reports.csv"))

# Find newly published reports 
prev_published <- readr::read_csv(glue::glue(here::here(), "/data/published_reports.csv")) %>% 
  dplyr::select(link) %>% 
  dplyr::pull()
newly_published <- setdiff(season_reports, prev_published)


if(length(newly_published) > 0) {

  # If new season reports have been published...
  # Need to loop through the new reports and extract award winners/details
  all_awards <- list(rep(NA, length(newly_published))) # need to change season_reports to newly_published later
  for(s in seq(1:length(newly_published))){ # ditto
    url <- newly_published[s] # ditto
    league <- ifelse(str_detect(url, "stats_4545"), 
                     "4545", 
                     ifelse(str_detect(url, "stats_lwopen"), 
                            "LW Open", 
                            ifelse(str_detect(url, "stats_lwu1800"), 
                                   "LW U1800", 
                                   ifelse(str_detect(url, "stats_chess960"),
                                          "Chess960",
                                          ""))))
    
    season <- as.integer(str_extract(url, "(?<=_s)\\d+"))
    
    # Get the right XML child number for the league/season
    # Required because the Dec 2021 changes to season reports changed the section
    # order...so all reports produced since then should use 4, and all reports
    # yet to be re-produced should use 5.
    xml_child_number <- ifelse(league == "4545",
                               4,
                               
                               ifelse(league == "LW Open",
                                     4,
                                      
                                      ifelse(league == "LW U1800",
                                             4,
                                             
                                             ifelse(league == "Chess960",
                                                    4,
                                                    NA_real_))))
    
    
    # Read and parse each report's awards table
    awards <- read_html(url) %>%
      rvest::html_element("#awards") %>% 
      xml_child(xml_child_number) %>% 
      html_text2() %>% 
      parse_json()
    
    # Tidy award data
    awards_tidy <- as_tibble(awards$x$tag$attribs$data) %>%
      mutate(League = league, Season = season) %>% 
      select(-c(Image)) %>% 
      select(League, Season, Award, Winner, Details, Mentions) %>% 
      # Flatten list to columns, turning NULL values to NAs
      mutate(Award = Award %>% lapply(function(x) ifelse(is.null(x), NA, x)) %>% purrr::flatten() %>% unlist(),
             Winner = Winner %>% lapply(function(x) ifelse(is.null(x), NA, x)) %>% purrr::flatten() %>% unlist(),
             Details = Details %>% lapply(function(x) ifelse(is.null(x), NA, x)) %>% purrr::flatten() %>% unlist(),
             Mentions = Mentions %>% lapply(function(x) ifelse(is.null(x), NA, x)) %>% purrr::flatten() %>% unlist()
             )
    
    all_awards[[s]] <- awards_tidy
    cli::cli_inform("{league} S{season} done")
    Sys.sleep(0.1)
  }
  
  # After going through the newly published reports
  # Combine everything into a single data frame
  awards <- data.table::rbindlist(all_awards) %>% 
    tibble::as_tibble()
  
  # Tidy the combined data
  awards <- awards %>% 
    filter(Winner != "") %>% # exclude non-awarded awards
    filter(!(Award %in% c("Egalitarian Award", "Team Accuracy", "Radjabov Award"))) %>% # exclude team-based awards
    arrange(Winner) %>% 
    mutate(league_season = paste0(League, " S", Season)) %>% 
    select(Winner, league_season, Award, Details, Mentions)
    
  awards$Winner <- str_replace_all(awards$Winner, "^,\\s", "")
  rm(all_awards, awards_tidy)
  
  # Exclude all ToS violators from awards table
  source(paste0(here::here(), "/R/identify_tos_violators.R"))
  toscrub <- str_c(tos_violators, collapse = "|") 
  awards$Winner <- stringr::str_remove_all(awards$Winner, 
                                                    toscrub)
  # Tidy up any after-effects
  awards$Winner <- str_replace_all(awards$Winner, "^,\\s", "")
  awards$Winner <- str_replace_all(awards$Winner, ",\\s,", ",")
  awards$Winner <- str_replace_all(awards$Winner, ",\\s,", ",")
  
  # Save awards permanently
  # readr::write_csv(awards, 
  #                  file = glue::glue(here::here(), "/data/all_award_winners.csv")
  
  # # Read previous published all-seasons awards table
  # prev_awards <- readr::read_csv(glue::glue(here::here(), "/data/all_award_winners.csv"))
  # 
  # # Add newly published awards to previous all-seasons table
  # latest_awards <- rbind(prev_awards, awards)
  # latest_awards <- latest_awards %>% 
  #   arrange(Winner)
  
  latest_awards <- awards %>% arrange(Winner)
  
} else {
  
  
  # If no new reports have been published, we still need to check if any names
  # in the current all-seasons table need to be scrubbed due to ToS violations
  cli::cli_alert_warning("No new season reports have been published.")
  
  # Read previous published all-seasons awards table
  latest_awards <- readr::read_csv(glue::glue(here::here(), "/data/all_award_winners.csv"))
  latest_awards <- latest_awards %>% tibble::as_tibble()
  
  source(paste0(here::here(), "/R/identify_tos_violators.R"))
  toscrub <- str_c(tos_violators, collapse = "|") 
  latest_awards$Winner <- stringr::str_remove_all(latest_awards$Winner, 
                                                    toscrub)
  # Tidy up any after-effects
  latest_awards$Winner <- str_replace_all(latest_awards$Winner, "^,\\s", "")
  latest_awards$Winner <- str_replace_all(latest_awards$Winner, ",\\s,", ",")
  latest_awards$Winner <- str_replace_all(latest_awards$Winner, ",\\s,", ",")
  
}

# Save and publish new all-seasons table
readr::write_csv(latest_awards,
                 file = glue::glue(here::here(), "/data/all_award_winners.csv"))

# Publish latest awards table

# First read it again
latest_awards <- readr::read_csv(glue::glue(here::here(), "/data/all_award_winners.csv"))
latest_awards <- latest_awards %>% tibble::as_tibble()

# Tidy final table
latest_awards_tidied <- latest_awards %>% 
  tidyr::separate(col = league_season,
                  into = c("league", "season"),
                  sep = "S(?=\\d+)") %>% 
  mutate(league = str_trim(league), 
         season = str_trim(season)) %>% 
  tidyr::separate_rows(Winner, sep = ",\\s") %>% 
  mutate(Winner = str_trim(Winner)) %>% 
  tidyr::separate_rows(Mentions, sep = ",\\s") %>% 
  mutate(Mentions = str_trim(Mentions))

winners_tidied <- latest_awards_tidied %>% 
  filter(!(is.na(Winner))) %>% 
  dplyr::select(-c(Mentions)) %>% 
  mutate(winner = TRUE,
         runnerup = FALSE) %>% 
  rename("Player" = Winner) %>% 
  dplyr::select(Player, Award, league, season, winner, runnerup, Details)

mentions_tidied <- latest_awards_tidied %>% 
  filter(!(is.na(Mentions))) %>% 
  dplyr::select(-c(Winner)) %>% 
  mutate(winner = FALSE,
         runnerup = TRUE,
         Details = "") %>% 
  rename("Player" = Mentions) %>% 
  dplyr::select(Player, Award, league, season, winner, runnerup, Details)

awards_final <- rbind(winners_tidied, mentions_tidied)

awards_final <- awards_final %>% 
  dplyr::distinct(., .keep_all = T) %>% 
  mutate(position = case_when(
    winner == TRUE ~ "Winner",
    runnerup == TRUE ~ "2nd/3rd",
    TRUE ~ NA_character_
  )) %>% 
  mutate(season = as.numeric(season)) %>% 
  dplyr::select(Player, Award, league, season, position, Details)

# Do a final scrub of all ineligible players
awards_final$Player <- stringr::str_remove_all(
  stringr::str_to_lower(awards_final$Player), 
  stringr::str_to_lower(toscrub))

# Show final table
reactable(awards_final,
          filterable = TRUE,
          pagination = TRUE, 
          fullWidth = TRUE,
          resizable = TRUE,
          searchable = TRUE,
          compact = TRUE,
          striped = TRUE,
         
          columns = list(
            Player = colDef(name = "Player", align = "left", minWidth = 200),
            Award = colDef(name = "Award", minWidth = 150),
            league = colDef(name = "League", minWidth = 100),
            season = colDef(name = "Season", minWidth = 90),
            position = colDef(name = "Rank", minWidth = 100),
            Details = colDef(name = "Details", minWidth = 250)
            ),
           defaultSorted = c("Award", "Player", "position")
)

cli::cli_alert_success("The all-seasons awards page has been updated")

```

Includes all eligible players mentioned in a published 4545, LoneWolf or Chess960 awards tables ([example](https://rahulan-c.github.io/lichess4545-stats/reports/stats_lwopen_s05.html#Awards)). Details are only published for award winners. See below for a list of award definitions.

- **Aces**: scored +6 or better
- **Archbishop of Accuracy**: lowest average centipawn loss (ACPL) in undecided positions after move 10
- **Awesome Alt**: played for the most teams during the season
- **Bullet Boss**: most moves made in under 0.5 seconds
- **David Award**: faced the strongest opposition
- **Gambit Guru**: best score playing gambits
- **Giri Award**: most draws
- **Grischuk's Cousin**: least time remaining after move 10 while going on to win
- **Houdini Award**: biggest comebacks
- **Intimate with Increment**: highest % of moves played with less than a minute on the clock
- **Musing or Snoozing**: longest time spent on a single move
- **MVP Award**: best season performance rating relative to initial rating
- **Primates of Precision**: most games < 10 ACPL
- **Rookie Award**: best season performance rating for a new league player
- **Saved by the Bell**: most moves made with < 5s left before winning
- **Slingshot Specialist**: most upset wins across the season
- **Tarjan Award**: achieved the biggest upset
- **Tetrarch of Time**: spent the most clock time across the season




